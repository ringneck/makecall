<!DOCTYPE html>
<html>
<head>
    <title>FCM Diagnostic Tool</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üîç FCM Diagnostic Tool</h1>
    <div id="results"></div>
    
    <script type="module">
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        // Firebase ÏÑ§Ï†ï
        const firebaseConfig = {
            apiKey: 'AIzaSyCB4mI5Kj61f6E532vg46GnmnnCfsI9XIM',
            appId: '1:793164633643:web:76f1f17cff465a5fccfc6e',
            messagingSenderId: '793164633643',
            projectId: 'makecallio',
            authDomain: 'makecallio.firebaseapp.com',
            storageBucket: 'makecallio.firebasestorage.app',
        };
        
        const vapidKey = 'BM2qgTRRwT-mG4shgKLDr7CnVf5-xVs3DqNNcqY7zzHZXd5P5xWqvCLn8BxGnqJ3YKj0zcY6Kp0YwQ_Zr8vK2jM';
        
        log('üîß Firebase Config:', 'info');
        log('<pre>' + JSON.stringify(firebaseConfig, null, 2) + '</pre>');
        
        // Firebase SDK ÎèôÏ†Å Î°úÎìú
        log('üì¶ Loading Firebase SDK...', 'info');
        
        import('https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js')
            .then(({ initializeApp }) => {
                log('‚úÖ Firebase App loaded', 'success');
                const app = initializeApp(firebaseConfig);
                return import('https://www.gstatic.com/firebasejs/10.7.0/firebase-messaging.js');
            })
            .then(({ getMessaging, getToken }) => {
                log('‚úÖ Firebase Messaging loaded', 'success');
                const messaging = getMessaging();
                
                log('üîë Requesting FCM token with VAPID key...', 'info');
                log('<pre>VAPID: ' + vapidKey.substring(0, 30) + '...</pre>');
                
                return getToken(messaging, { vapidKey });
            })
            .then((token) => {
                log('‚úÖ FCM Token obtained successfully!', 'success');
                log('<pre>Token: ' + token.substring(0, 50) + '...</pre>');
                log('<pre>Full Length: ' + token.length + ' characters</pre>');
            })
            .catch((error) => {
                log('‚ùå Error: ' + error.message, 'error');
                log('<pre>' + error.stack + '</pre>');
                
                if (error.code === 'messaging/token-subscribe-failed') {
                    log('<br>üîç <b>Diagnosis:</b>', 'error');
                    log('‚Ä¢ This error usually means:', 'error');
                    log('  1. VAPID key mismatch with Firebase Console', 'error');
                    log('  2. Web App not properly configured in Firebase', 'error');
                    log('  3. Service Worker registration issue', 'error');
                    log('<br>üìã <b>Next Steps:</b>', 'info');
                    log('‚Ä¢ Check Firebase Console > Cloud Messaging > Web Push Certificate', 'info');
                    log('‚Ä¢ Verify Web App ID: 1:793164633643:web:76f1f17cff465a5fccfc6e', 'info');
                    log('‚Ä¢ Compare VAPID key in console with code', 'info');
                }
            });
    </script>
</body>
</html>
