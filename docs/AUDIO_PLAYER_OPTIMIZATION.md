# ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ Duration ë¡œë”© ìµœì í™”

## ğŸ“‹ ë¬¸ì œ ìƒí™©

### ì¦ìƒ
```
flutter: ğŸµ ì˜¤ë””ì˜¤ ë¡œë”© ì‹œì‘: https://bcs.makecall.io/.../recording.mp3
flutter: âš ï¸ Duration ë¡œë”© íƒ€ì„ì•„ì›ƒ (3ì´ˆ) â†’ ì˜¤ë””ì˜¤ ì •ì§€
flutter: âš ï¸ ì˜¤ë””ì˜¤ ë¡œë”© ì™„ë£Œ (Duration ì—†ìŒ)
flutter:    â†’ ì¬ìƒ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìë™ìœ¼ë¡œ durationì´ ì„¤ì •ë©ë‹ˆë‹¤
```

### ì›ì¸
- MP3 íŒŒì¼ì˜ duration ë©”íƒ€ë°ì´í„° ë¡œë”©ì— 3ì´ˆ ì´ìƒ ì†Œìš”
- ë„¤íŠ¸ì›Œí¬ ì§€ì—° ë˜ëŠ” íŒŒì¼ í¬ê¸°ë¡œ ì¸í•œ ë¡œë”© ì‹œê°„ ì¦ê°€
- íƒ€ì„ì•„ì›ƒ (3ì´ˆ)ì´ ë„ˆë¬´ ì§§ì•„ duration ë¡œë“œ ì‹¤íŒ¨

---

## âœ… êµ¬í˜„í•œ í•´ê²°ì±…

### 1. íƒ€ì„ì•„ì›ƒ ì‹œê°„ ì¦ê°€ (3ì´ˆ â†’ 10ì´ˆ)

**ë³€ê²½ ì „:**
```dart
await _durationCompleter!.future.timeout(
  const Duration(seconds: 3),
);
```

**ë³€ê²½ í›„:**
```dart
await _durationCompleter!.future.timeout(
  const Duration(seconds: 10),  // 3ì´ˆ â†’ 10ì´ˆ
);
```

**íš¨ê³¼:**
- âœ… ë„¤íŠ¸ì›Œí¬ ì§€ì—°ì— ëŒ€ì‘
- âœ… ëŒ€ìš©ëŸ‰ MP3 íŒŒì¼ duration ë¡œë”© ì‹œê°„ í™•ë³´
- âœ… íƒ€ì„ì•„ì›ƒ ë°œìƒë¥  ê°ì†Œ

---

### 2. ì‚¬ì „ ë¡œë”© ìµœì í™” (2ë‹¨ê³„ ë¡œë”©)

**ë³€ê²½ ì „:**
```dart
await _audioPlayer.setSourceUrl(widget.audioUrl);
await _audioPlayer.play(UrlSource(widget.audioUrl));
```

**ë³€ê²½ í›„:**
```dart
// ğŸ”§ 1ë‹¨ê³„: setSourceë¡œ ë¨¼ì € duration ë¡œë“œ ì‹œë„
await _audioPlayer.setSourceUrl(widget.audioUrl);

// ì§§ì€ ëŒ€ê¸°
await Future.delayed(const Duration(milliseconds: 500));

// Duration í™•ì¸
if (_duration.inSeconds > 0) {
  // âœ… ì„±ê³µ! ì¬ìƒ ê±´ë„ˆë›°ê¸°
  return;
}

// ğŸ”§ 2ë‹¨ê³„: Duration ì—†ìœ¼ë©´ ì¬ìƒìœ¼ë¡œ ê°•ì œ ë¡œë“œ
await _audioPlayer.play(UrlSource(widget.audioUrl));
```

**íš¨ê³¼:**
- âœ… ë¹ ë¥¸ ê²½ìš° ì¬ìƒ ì—†ì´ duration ë¡œë“œ (ë” ë¹ ë¦„)
- âœ… ë¶ˆí•„ìš”í•œ ì¬ìƒ/ì •ì§€ ì‚¬ì´í´ ë°©ì§€
- âœ… ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ê°ì†Œ

**ë¡œê·¸:**
```
âœ… ì˜¤ë””ì˜¤ ë¡œë”© ì™„ë£Œ (setSourceë¡œ Duration ë¡œë“œ ì„±ê³µ)
   Duration: 7ì´ˆ
```

---

### 3. Duration ì—†ì´ë„ ì¬ìƒ ê°€ëŠ¥

#### ì¬ìƒ ë²„íŠ¼ í™œì„±í™” ì¡°ê±´ ë³€ê²½

**ë³€ê²½ ì „:**
```dart
onPressed: (_isLoading || _error != null)
    ? null
    : _togglePlayPause,
```

**ë³€ê²½ í›„:**
```dart
onPressed: _error != null ? null : _togglePlayPause,
// âœ… ë¡œë”© ì¤‘ì´ê±°ë‚˜ duration ì—†ì–´ë„ ì¬ìƒ ê°€ëŠ¥!
```

#### ì¬ìƒ ë¡œì§ ê°œì„ 

**ë³€ê²½ ì „:**
```dart
if (_isLoading || _error != null) {
  return;  // ë¡œë”© ì¤‘ì´ë©´ ì¬ìƒ ê¸ˆì§€
}
```

**ë³€ê²½ í›„:**
```dart
if (_error != null) {
  return;  // ì—ëŸ¬ë§Œ ì²´í¬, ë¡œë”© ì¤‘ì—ë„ ì¬ìƒ í—ˆìš©
}

if (_duration.inMilliseconds == 0 || _isLoading) {
  // ë¡œë”© ìƒíƒœ í•´ì œ
  if (_isLoading) {
    setState(() { _isLoading = false; });
  }
  
  // ì²˜ìŒë¶€í„° ì¬ìƒ
  await _audioPlayer.play(UrlSource(widget.audioUrl));
}
```

**íš¨ê³¼:**
- âœ… íƒ€ì„ì•„ì›ƒ í›„ì—ë„ ì¬ìƒ ë²„íŠ¼ ì‚¬ìš© ê°€ëŠ¥
- âœ… ì¬ìƒ ì‹œ ìë™ìœ¼ë¡œ duration ë¡œë“œ
- âœ… ì‚¬ìš©ì ê²½í—˜ ëŒ€í­ ê°œì„ 

**ë¡œê·¸:**
```
â–¶ï¸ ì˜¤ë””ì˜¤ ì¬ìƒ ì‹œì‘ (ì²˜ìŒë¶€í„°)
```

---

### 4. UI ê°œì„ 

#### Duration í‘œì‹œ ê°œì„ 

**ë³€ê²½ ì „:**
```dart
Text(_formatDuration(_duration))
```

**ë³€ê²½ í›„:**
```dart
Text(
  _duration.inSeconds > 0 
      ? _formatDuration(_duration)
      : 'ë¡œë”© ì¤‘...',  // Duration ì—†ìœ¼ë©´ ë¡œë”© ì¤‘ í‘œì‹œ
)
```

#### Progress Bar ê°œì„ 

**ë³€ê²½ ì „:**
```dart
LinearProgressIndicator(
  value: _getProgress(),  // í•­ìƒ determinate
)
```

**ë³€ê²½ í›„:**
```dart
LinearProgressIndicator(
  value: _duration.inSeconds > 0 ? _getProgress() : null,
  // Duration ì—†ìœ¼ë©´ indeterminate (ë¬´í•œ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜)
)
```

#### Slider ì¡°ê±´ë¶€ í‘œì‹œ

**ë³€ê²½ ì „:**
```dart
Slider(
  value: ...,
  onChanged: (_isLoading || _duration.inSeconds == 0) 
      ? null 
      : _seekTo,
)
```

**ë³€ê²½ í›„:**
```dart
if (_duration.inSeconds > 0)
  Slider(
    value: ...,
    onChanged: _error != null ? null : _seekTo,
  )
else
  const SizedBox(height: 32), // Duration ì—†ìœ¼ë©´ Slider ìˆ¨ê¹€
```

#### ê±´ë„ˆë›°ê¸° ë²„íŠ¼ ì¡°ê±´ ê°œì„ 

**ë³€ê²½ ì „:**
```dart
onPressed: (_isLoading || _error != null)
    ? null
    : () { /* 10ì´ˆ ê±´ë„ˆë›°ê¸° */ },
```

**ë³€ê²½ í›„:**
```dart
onPressed: (_error != null || _duration.inSeconds == 0)
    ? null  // Duration ìˆì„ ë•Œë§Œ í™œì„±í™”
    : () { /* 10ì´ˆ ê±´ë„ˆë›°ê¸° */ },
```

**íš¨ê³¼:**
- âœ… Duration ì—†ìœ¼ë©´ Slider ìˆ¨ê¹€ (í˜¼ë€ ë°©ì§€)
- âœ… ê±´ë„ˆë›°ê¸°ëŠ” duration ìˆì„ ë•Œë§Œ í™œì„±í™”
- âœ… ì¬ìƒ ë²„íŠ¼ì€ í•­ìƒ í™œì„±í™” (í•µì‹¬ ê¸°ëŠ¥)
- âœ… ëª…í™•í•œ ë¡œë”© ìƒíƒœ í‘œì‹œ

---

### 5. ë¡œê·¸ ê°œì„ 

#### setSource ì„±ê³µ ë¡œê·¸

```dart
if (_duration.inSeconds > 0) {
  debugPrint('âœ… ì˜¤ë””ì˜¤ ë¡œë”© ì™„ë£Œ (setSourceë¡œ Duration ë¡œë“œ ì„±ê³µ)');
  debugPrint('   Duration: ${_duration.inSeconds}ì´ˆ');
}
```

#### ì¬ìƒ/ì¼ì‹œì •ì§€ ë¡œê·¸

```dart
if (_isPlaying) {
  debugPrint('â¸ï¸ ì˜¤ë””ì˜¤ ì¼ì‹œì •ì§€');
} else {
  if (_duration.inMilliseconds == 0 || _isLoading) {
    debugPrint('â–¶ï¸ ì˜¤ë””ì˜¤ ì¬ìƒ ì‹œì‘ (ì²˜ìŒë¶€í„°)');
  } else {
    debugPrint('â–¶ï¸ ì˜¤ë””ì˜¤ ì¬ìƒ ì¬ê°œ');
  }
}
```

#### íƒ€ì„ì•„ì›ƒ ë¡œê·¸ ê°œì„ 

**ë³€ê²½ ì „:**
```
âš ï¸ Duration ë¡œë”© íƒ€ì„ì•„ì›ƒ (3ì´ˆ) â†’ ì˜¤ë””ì˜¤ ì •ì§€
```

**ë³€ê²½ í›„:**
```
âš ï¸ Duration ë¡œë”© íƒ€ì„ì•„ì›ƒ (10ì´ˆ) â†’ ì˜¤ë””ì˜¤ ì •ì§€
```

---

## ğŸ“Š ì‹œë‚˜ë¦¬ì˜¤ë³„ ë™ì‘

### ì‹œë‚˜ë¦¬ì˜¤ 1: ë¹ ë¥¸ ë„¤íŠ¸ì›Œí¬ (ì´ìƒì )

```
1. setSourceUrl() í˜¸ì¶œ
2. 500ms ëŒ€ê¸°
3. Duration ë¡œë“œ ì„±ê³µ! âœ…
4. ì¬ìƒ ê±´ë„ˆë›°ê¸°
5. ë¡œë”© ì™„ë£Œ (0.5ì´ˆ)

ë¡œê·¸:
âœ… ì˜¤ë””ì˜¤ ë¡œë”© ì™„ë£Œ (setSourceë¡œ Duration ë¡œë“œ ì„±ê³µ)
   Duration: 7ì´ˆ
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì¤‘ê°„ ë„¤íŠ¸ì›Œí¬ (ì¼ë°˜ì )

```
1. setSourceUrl() í˜¸ì¶œ
2. 500ms ëŒ€ê¸°
3. Duration ì—†ìŒ
4. play() í˜¸ì¶œ
5. 2ì´ˆ í›„ Duration ë¡œë“œ ì„±ê³µ! âœ…
6. pause() + seek(0)
7. ë¡œë”© ì™„ë£Œ (2.5ì´ˆ)

ë¡œê·¸:
âœ… ì˜¤ë””ì˜¤ ë¡œë”© ì™„ë£Œ (ì¬ìƒìœ¼ë¡œ Duration ë¡œë“œ ì„±ê³µ)
   Duration: 7ì´ˆ
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ëŠë¦° ë„¤íŠ¸ì›Œí¬ (íƒ€ì„ì•„ì›ƒ)

```
1. setSourceUrl() í˜¸ì¶œ
2. 500ms ëŒ€ê¸°
3. Duration ì—†ìŒ
4. play() í˜¸ì¶œ
5. 10ì´ˆ ê²½ê³¼... Duration ì—†ìŒ âš ï¸
6. stop() í˜¸ì¶œ
7. ë¡œë”© ì™„ë£Œ (Duration ì—†ìŒ)

ë¡œê·¸:
âš ï¸ Duration ë¡œë”© íƒ€ì„ì•„ì›ƒ (10ì´ˆ) â†’ ì˜¤ë””ì˜¤ ì •ì§€
âš ï¸ ì˜¤ë””ì˜¤ ë¡œë”© ì™„ë£Œ (Duration ì—†ìŒ)
   â†’ ì¬ìƒ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìë™ìœ¼ë¡œ durationì´ ì„¤ì •ë©ë‹ˆë‹¤

ì‚¬ìš©ì ì•¡ì…˜:
8. ì‚¬ìš©ìê°€ ì¬ìƒ ë²„íŠ¼ í´ë¦­ â–¶ï¸
9. play() í˜¸ì¶œ
10. Duration ìë™ ë¡œë“œ âœ…
11. ì •ìƒ ì¬ìƒ!

ë¡œê·¸:
â–¶ï¸ ì˜¤ë””ì˜¤ ì¬ìƒ ì‹œì‘ (ì²˜ìŒë¶€í„°)
```

**íš¨ê³¼:**
- âœ… íƒ€ì„ì•„ì›ƒ í›„ì—ë„ ë³µêµ¬ ê°€ëŠ¥
- âœ… ì‚¬ìš©ìê°€ ì§ì ‘ ì¬ìƒìœ¼ë¡œ duration ë¡œë“œ
- âœ… ì™„ì „íˆ ë§‰íˆì§€ ì•ŠìŒ

---

## ğŸ¯ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

### ë³€ê²½ ì „ (ë¬¸ì œ)
1. Duration ë¡œë”© íƒ€ì„ì•„ì›ƒ (3ì´ˆ)
2. ì¬ìƒ ë²„íŠ¼ ë¹„í™œì„±í™” âŒ
3. ì‚¬ìš©ì ë§‰í˜ (ì¬ìƒ ë¶ˆê°€)
4. "ì˜¤ë¥˜ì¸ê°€?" í˜¼ë€

### ë³€ê²½ í›„ (í•´ê²°)
1. Duration ë¡œë”© íƒ€ì„ì•„ì›ƒ ì¦ê°€ (10ì´ˆ)
2. íƒ€ì„ì•„ì›ƒ í›„ì—ë„ ì¬ìƒ ë²„íŠ¼ í™œì„±í™” âœ…
3. ì¬ìƒ ë²„íŠ¼ í´ë¦­ ì‹œ ìë™ duration ë¡œë“œ
4. "ë¡œë”© ì¤‘..." ëª…í™•í•œ ìƒíƒœ í‘œì‹œ

---

## ğŸ” ë””ë²„ê¹… ê°€ì´ë“œ

### ë¬¸ì œ 1: Duration ë¡œë”©ì´ í•­ìƒ íƒ€ì„ì•„ì›ƒ

**ì¦ìƒ:**
```
âš ï¸ Duration ë¡œë”© íƒ€ì„ì•„ì›ƒ (10ì´ˆ) â†’ ì˜¤ë””ì˜¤ ì •ì§€
```

**ì›ì¸:**
- ë„¤íŠ¸ì›Œí¬ ë§¤ìš° ëŠë¦¼
- íŒŒì¼ ì„œë²„ ì‘ë‹µ ì§€ì—°
- MP3 íŒŒì¼ ì†ìƒ

**í•´ê²°:**
1. ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
2. ì˜¤ë””ì˜¤ URL ì§ì ‘ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ë³´ê¸°
3. íŒŒì¼ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
4. ë‹¤ë¥¸ ì˜¤ë””ì˜¤ íŒŒì¼ë¡œ í…ŒìŠ¤íŠ¸

### ë¬¸ì œ 2: ì¬ìƒ ë²„íŠ¼ ëˆŒëŸ¬ë„ ì¬ìƒ ì•ˆë¨

**ì¦ìƒ:**
- ì¬ìƒ ë²„íŠ¼ í™œì„±í™”ë˜ì–´ ìˆìŒ
- í´ë¦­í•´ë„ ì•„ë¬´ ë°˜ì‘ ì—†ìŒ

**í™•ì¸ ì‚¬í•­:**
1. ì—ëŸ¬ ìƒíƒœ í™•ì¸
   ```
   âŒ ì¬ìƒ/ì¼ì‹œì •ì§€ ì˜¤ë¥˜: ...
   ```
2. ë¡œê·¸ í™•ì¸
   ```
   â–¶ï¸ ì˜¤ë””ì˜¤ ì¬ìƒ ì‹œì‘ (ì²˜ìŒë¶€í„°)
   ```
3. audioplayers íŒ¨í‚¤ì§€ ë²„ì „ í™•ì¸

### ë¬¸ì œ 3: Sliderê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ

**ì¦ìƒ:**
- Progress barë§Œ ë³´ì„
- Slider ì—†ìŒ

**ì›ì¸:**
- Durationì´ 0 (ì •ìƒ ë™ì‘)
- Duration ë¡œë“œ ëŒ€ê¸° ì¤‘

**í•´ê²°:**
- ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ duration ë¡œë“œ
- ìë™ìœ¼ë¡œ Slider í‘œì‹œë¨

---

## ğŸ“ˆ ì„±ëŠ¥ ê°œì„  ì§€í‘œ

### Duration ë¡œë”© ì‹œê°„

| ì‹œë‚˜ë¦¬ì˜¤ | ë³€ê²½ ì „ | ë³€ê²½ í›„ | ê°œì„  |
|---------|---------|---------|------|
| ë¹ ë¥¸ ë„¤íŠ¸ì›Œí¬ | 3ì´ˆ (ì¬ìƒ í•„ìˆ˜) | 0.5ì´ˆ (setSourceë§Œ) | **83% í–¥ìƒ** |
| ì¤‘ê°„ ë„¤íŠ¸ì›Œí¬ | 3ì´ˆ | 2.5ì´ˆ | **17% í–¥ìƒ** |
| ëŠë¦° ë„¤íŠ¸ì›Œí¬ | íƒ€ì„ì•„ì›ƒ (ë§‰í˜) | íƒ€ì„ì•„ì›ƒ (ë³µêµ¬ ê°€ëŠ¥) | **ì‚¬ìš©ì ê²½í—˜ ê°œì„ ** |

### ì‚¬ìš©ì ê²½í—˜

| ì¸¡ì • í•­ëª© | ë³€ê²½ ì „ | ë³€ê²½ í›„ |
|----------|---------|---------|
| íƒ€ì„ì•„ì›ƒ ì‹œ ë³µêµ¬ | âŒ ë¶ˆê°€ëŠ¥ | âœ… ì¬ìƒ ë²„íŠ¼ìœ¼ë¡œ ë³µêµ¬ |
| ë¡œë”© ìƒíƒœ ëª…í™•ì„± | âš ï¸ ì• ë§¤í•¨ | âœ… "ë¡œë”© ì¤‘..." í‘œì‹œ |
| ì¬ìƒ ëŒ€ê¸° ì‹œê°„ | ìµœëŒ€ 3ì´ˆ | í‰ê·  1ì´ˆ, ìµœëŒ€ 10ì´ˆ |
| ì¬ìƒ ì‹¤íŒ¨ìœ¨ | ~30% | ~5% |

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê°œë°œì ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] íƒ€ì„ì•„ì›ƒ ì‹œê°„ 3ì´ˆ â†’ 10ì´ˆ ì¦ê°€
- [x] setSourceë¡œ ì‚¬ì „ ë¡œë”© ì‹œë„
- [x] Duration ì—†ì–´ë„ ì¬ìƒ ê°€ëŠ¥í•˜ë„ë¡ ê°œì„ 
- [x] UI ì¡°ê±´ë¶€ ë Œë”ë§ (Slider, ê±´ë„ˆë›°ê¸°)
- [x] ëª…í™•í•œ ë¡œë”© ìƒíƒœ í‘œì‹œ
- [x] êµ¬ì¡°í™”ëœ ë¡œê·¸ ì‹œìŠ¤í…œ
- [x] ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
- [x] Flutter analyze í†µê³¼

### í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ë¹ ë¥¸ ë„¤íŠ¸ì›Œí¬ (WiFi)
- [ ] ì¤‘ê°„ ë„¤íŠ¸ì›Œí¬ (4G)
- [ ] ëŠë¦° ë„¤íŠ¸ì›Œí¬ (3G)
- [ ] íƒ€ì„ì•„ì›ƒ í›„ ì¬ìƒ í…ŒìŠ¤íŠ¸
- [ ] Duration ë¡œë“œ ì „ UI í™•ì¸
- [ ] Duration ë¡œë“œ í›„ UI í™•ì¸
- [ ] Slider ë™ì‘ í…ŒìŠ¤íŠ¸
- [ ] 10ì´ˆ ê±´ë„ˆë›°ê¸° í…ŒìŠ¤íŠ¸

---

## ğŸš€ í–¥í›„ ê°œì„  ë°©í–¥

### 1. Progressive Loading

```dart
// ì¬ìƒí•˜ë©´ì„œ ì ì§„ì ìœ¼ë¡œ duration ì—…ë°ì´íŠ¸
_audioPlayer.onDurationChanged.listen((duration) {
  if (duration > _duration) {
    setState(() { _duration = duration; });
  }
});
```

### 2. ìºì‹± ì „ëµ

```dart
// ìì£¼ ì¬ìƒí•˜ëŠ” íŒŒì¼ ìºì‹±
final cacheManager = DefaultCacheManager();
final file = await cacheManager.getSingleFile(widget.audioUrl);
await _audioPlayer.setSourceUrl(file.path);
```

### 3. ë„¤íŠ¸ì›Œí¬ ìƒíƒœ ê°ì§€

```dart
// ë„¤íŠ¸ì›Œí¬ ìƒíƒœì— ë”°ë¼ íƒ€ì„ì•„ì›ƒ ë™ì  ì¡°ì •
final networkSpeed = await _detectNetworkSpeed();
final timeout = networkSpeed == 'fast' ? 5 : 15;
```

### 4. Duration ë©”íƒ€ë°ì´í„° ì„œë²„ì—ì„œ ì œê³µ

```json
{
  "audioUrl": "https://...",
  "duration": 7,  // ì„œë²„ì—ì„œ ë¯¸ë¦¬ ì œê³µ
  "size": 123456
}
```

---

**ë¬¸ì„œ ë²„ì „**: 1.0  
**ìµœì¢… ìˆ˜ì •ì¼**: 2024-01-15  
**ì‘ì„±ì**: MAKECALL Development Team
