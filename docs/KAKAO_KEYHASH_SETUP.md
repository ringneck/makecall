# 🔑 카카오 안드로이드 키해시 등록 가이드

## ❌ 문제 증상

안드로이드에서 카카오 로그인 시 다음과 같은 오류가 발생합니다:

```
I/flutter: ⚠️ [Kakao] 카카오톡 앱 로그인 실패, 웹뷰로 전환: 
{error: invalid_request, error_description: Android keyHash validation failed.}
```

## 🎯 해결 방법

카카오 개발자 콘솔에 앱의 **키해시(Key Hash)**를 등록해야 합니다.

## 📋 단계별 가이드

### 1️⃣ 키해시 확인

프로젝트 루트에서 다음 스크립트를 실행합니다:

```bash
bash scripts/get_kakao_keyhash.sh
```

**출력 예시:**

```
======================================================
🔑 안드로이드 카카오 키해시 확인
======================================================

1️⃣  디버그 키해시 (개발/테스트용)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
S2YA/GyMTkXRL75qlsJ0DFzVrIQ=
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

2️⃣  릴리즈 키해시 (배포용)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
GB7JD7zR/QQ4D+F6b42zKSDMrKY=
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 2️⃣ 카카오 개발자 콘솔 설정

#### 2-1. 카카오 개발자 콘솔 접속
- URL: https://developers.kakao.com
- 로그인 후 **내 애플리케이션** 선택

#### 2-2. Android 플랫폼 설정
1. 좌측 메뉴: **앱 설정** → **플랫폼**
2. **Android 플랫폼 등록** 클릭

#### 2-3. 플랫폼 정보 입력

| 항목 | 값 |
|------|-----|
| **패키지명** | `com.olssoo.makecall_app` |
| **마켓 URL** | (선택사항) Google Play Store URL |
| **키 해시** | 아래 참조 |

#### 2-4. 키해시 등록

**개발/테스트 환경:**
```
S2YA/GyMTkXRL75qlsJ0DFzVrIQ=
```

**배포 환경 (Google Play):**
```
GB7JD7zR/QQ4D+F6b42zKSDMrKY=
```

> ⚠️ **중요**: 두 키해시를 **모두** 등록하는 것을 권장합니다.
> - 디버그 키해시: 개발/테스트 시 사용
> - 릴리즈 키해시: 실제 배포 시 사용

#### 2-5. 저장 및 확인
1. **저장** 버튼 클릭
2. 약 **1~2분** 후부터 적용됨
3. 앱을 재시작하고 카카오 로그인 테스트

## 🔧 문제 해결

### Q1: 키해시가 계속 실패합니다

**원인**: 키스토어가 변경되었거나 다른 키스토어로 빌드됨

**해결**:
1. 현재 앱이 설치된 기기의 키해시를 다시 확인
2. 로그에서 실제 사용된 키해시 확인:
   ```
   adb logcat | grep -i "keyhash"
   ```
3. 확인된 키해시를 카카오 개발자 콘솔에 추가 등록

### Q2: 디버그 키스토어를 찾을 수 없습니다

**해결**:
1. Android Studio에서 앱을 한 번 실행
2. 자동으로 `~/.android/debug.keystore` 생성됨
3. 다시 스크립트 실행

### Q3: 릴리즈 키해시를 모르겠습니다

**해결**:
1. `android/key.properties` 파일 확인
2. 수동으로 키해시 생성:
   ```bash
   keytool -exportcert -alias <KEY_ALIAS> \
     -keystore android/release-key.jks | \
     openssl sha1 -binary | openssl base64
   ```

## 📱 테스트 방법

### 1. 앱 재설치
```bash
flutter clean
flutter pub get
flutter run
```

### 2. 카카오 로그인 시도
- 카카오톡 앱이 설치된 기기: **카카오톡으로 로그인** 동작
- 카카오톡 미설치: **웹뷰 로그인** 동작

### 3. 성공 로그 확인
```
I/flutter: ✅ [Kakao] 카카오톡 앱 로그인 성공
I/flutter: ✅ [Kakao] 로그인 완료: 사용자ID=1234567890
```

## 🔗 참고 문서

- [카카오 로그인 안드로이드 설정](https://developers.kakao.com/docs/latest/ko/kakaologin/android)
- [키해시 등록 가이드](https://developers.kakao.com/docs/latest/ko/getting-started/app#key-hash)
- [카카오 개발자 콘솔](https://developers.kakao.com/console/app)

## 💡 추가 정보

### 키해시란?
- 안드로이드 앱의 서명 인증서에서 생성된 **SHA-1 해시값의 Base64 인코딩**
- 카카오 API 호출 시 앱의 **보안 검증**을 위해 사용
- 각 키스토어마다 **고유한 키해시**가 생성됨

### 왜 두 개의 키해시가 필요한가요?
- **디버그 키해시**: 개발자가 로컬에서 테스트할 때 사용
- **릴리즈 키해시**: Google Play Store에 배포할 때 사용
- 각각 다른 키스토어를 사용하므로 **키해시도 다름**

### 키해시 등록 시 주의사항
- ✅ 정확한 패키지명 입력 (`com.olssoo.makecall_app`)
- ✅ 키해시 복사 시 **공백 없이** 정확하게 입력
- ✅ 여러 개의 키해시 등록 가능 (쉼표 구분)
- ✅ 등록 후 1~2분 대기 (서버 반영 시간)

---

**문제가 해결되지 않으면 카카오 개발자 포럼에 문의하세요:**
https://devtalk.kakao.com
