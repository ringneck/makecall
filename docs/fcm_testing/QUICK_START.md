# âš¡ FCM í…ŒìŠ¤íŠ¸ ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ

## ğŸ¯ 3ê°€ì§€ ê°„í¸í•œ í…ŒìŠ¤íŠ¸ ë°©ë²•

---

## ë°©ë²• 1: Python ìŠ¤í¬ë¦½íŠ¸ (ê°€ì¥ ê°„í¸) â­

### ğŸ“ **ìˆ˜ì‹  ì „í™” ì•Œë¦¼ ë°œì†¡**

```bash
cd /home/user/flutter_app
python3 docs/fcm_testing/send_fcm_test_message.py
```

**ëŒ€í™”í˜• ë©”ë‰´:**
```
ë©”ì‹œì§€ íƒ€ì…ì„ ì„ íƒí•˜ì„¸ìš”:
1. ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì•Œë¦¼
2. ìˆ˜ì‹  ì „í™” ì•Œë¦¼  â† 2 ì…ë ¥!
3. ë¶€ì¬ì¤‘ ì „í™” ì•Œë¦¼
4. ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼
5. ëª¨ë“  íƒ€ì… ìˆœì°¨ ë°œì†¡

ì„ íƒ (1-5, Enter=1): 2
```

**íŠ¹ì§•:**
- âœ… ì¸ì¦ ì™„ì „ ìë™í™”
- âœ… Firestoreì—ì„œ ìë™ìœ¼ë¡œ í™œì„± FCM í† í° ì¡°íšŒ
- âœ… 4ê°€ì§€ ë©”ì‹œì§€ í…œí”Œë¦¿ ì œê³µ
- âœ… ë¡œê·¸ ìë™ ì €ì¥

---

## ë°©ë²• 2: Shell ìŠ¤í¬ë¦½íŠ¸ (curl ì‚¬ìš©)

### ğŸ“ **ê¸°ë³¸ ì‚¬ìš©**

```bash
cd /home/user/flutter_app
./docs/fcm_testing/send_fcm_curl.sh
```

### ğŸ“ **ì»¤ìŠ¤í…€ ë°œì‹ ì ì •ë³´**

```bash
# FCM í† í° + ë°œì‹ ì ì´ë¦„ + ì „í™”ë²ˆí˜¸ ì§€ì •
./docs/fcm_testing/send_fcm_curl.sh \
  "YOUR_FCM_TOKEN" \
  "í™ê¸¸ë™" \
  "010-9876-5432"
```

**íŠ¹ì§•:**
- âœ… Access Token ìë™ ìƒì„±
- âœ… Firestoreì—ì„œ ìë™ í† í° ì¡°íšŒ
- âœ… ë‹¨ê³„ë³„ ì§„í–‰ ìƒí™© í‘œì‹œ
- âœ… ì»¬ëŸ¬í’€í•œ ì¶œë ¥

---

## ë°©ë²• 3: Postman/Insomnia (GUI)

### ğŸ“ **Step 1: Access Token ìƒì„±**

```bash
python3 docs/fcm_testing/get_access_token.py
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```
======================================================================
ğŸ”‘ FCM Access Token ì •ë³´
======================================================================

ğŸ“‹ Project ID:
   makecallio

ğŸ” Access Token (Bearer):
   ya29.c.c0ASRK0G...

â° Token ë§Œë£Œ ì‹œê°„:
   ì•½ 1ì‹œê°„ (ìë™ ê°±ì‹ ë¨)
```

### ğŸ“ **Step 2: Postman ì„¤ì •**

**Request:**
- **Method**: `POST`
- **URL**: `https://fcm.googleapis.com/v1/projects/makecallio/messages:send`

**Headers:**
```
Authorization: Bearer ya29.c.c0ASRK0G...
Content-Type: application/json
```

**Body (raw JSON):**
```json
{
  "message": {
    "token": "FCM_TOKEN_HERE",
    "notification": {
      "title": "ê¹€ì² ìˆ˜",
      "body": "010-1234-5678"
    },
    "data": {
      "type": "incoming_call",
      "caller_name": "ê¹€ì² ìˆ˜",
      "caller_number": "010-1234-5678",
      "caller_avatar": "",
      "callId": "call_12345"
    },
    "android": {
      "priority": "high"
    }
  }
}
```

**íŠ¹ì§•:**
- âœ… GUI í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸
- âœ… ìš”ì²­/ì‘ë‹µ ì €ì¥ ê°€ëŠ¥
- âœ… ì»¬ë ‰ì…˜ìœ¼ë¡œ ê´€ë¦¬ ê°€ëŠ¥

---

## ğŸ”‘ Authorization Key ë¹ ë¥¸ ì°¸ì¡°

### **í˜„ì¬ í”„ë¡œì íŠ¸ (ê¶Œì¥):**

```bash
# Access Token ìë™ ìƒì„±ë¨ (Python ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš© ì‹œ)
# ìˆ˜ë™ í™•ì¸ì´ í•„ìš”í•œ ê²½ìš°:
python3 docs/fcm_testing/get_access_token.py
```

### **Legacy Server Key (ë¹„ê¶Œì¥):**

1. Firebase Console: https://console.firebase.com/
2. Project Settings â†’ Cloud Messaging
3. Server key ë³µì‚¬

âš ï¸ **ì£¼ì˜**: Legacy APIëŠ” ê³§ ì§€ì› ì¢…ë£Œ ì˜ˆì •

---

## ğŸ“± FCM í† í° í™•ì¸ ë°©ë²•

### **ë°©ë²• 1: ì•± ë¡œê·¸ì¸ ì‹œ ì½˜ì†” ì¶œë ¥**

```
============================================================
ğŸ”” FCM í† í° ì •ë³´
============================================================
ğŸ“± ì „ì²´ í† í°:
eFG3hD9k2L7mP1qR4sT6vX8yZ0aC2eF4gH6jK8lM0nP2rT4vX6zB1cE3gH5jL7nQ9sU1wY3
============================================================
```

### **ë°©ë²• 2: Firestore ì§ì ‘ ì¡°íšŒ**

Firebase Console â†’ Firestore Database â†’ `fcm_tokens` ì»¬ë ‰ì…˜

---

## ğŸ¨ ì˜ˆìƒ ê²°ê³¼

### âœ… **ì„±ê³µ ì‹œ**

**Python ìŠ¤í¬ë¦½íŠ¸:**
```
âœ… ë©”ì‹œì§€ ë°œì†¡ ì„±ê³µ: projects/makecallio/messages/0:1234567890
```

**curl ìŠ¤í¬ë¦½íŠ¸:**
```
âœ… ë©”ì‹œì§€ ë°œì†¡ ì„±ê³µ!
ğŸ‰ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì‹  ì „í™” ì•Œë¦¼ì„ ë°œì†¡í–ˆìŠµë‹ˆë‹¤!
ğŸ’¡ ì•±ì„ í™•ì¸í•˜ì—¬ í’€ìŠ¤í¬ë¦°ì´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
```

**ì•± í™”ë©´:**
- ğŸŒŠ íŒŒë™ ì• ë‹ˆë©”ì´ì…˜ì´ í‘œì‹œëœ í’€ìŠ¤í¬ë¦°
- ğŸ‘¤ ë°œì‹ ì ì •ë³´ (ì•„ë°”íƒ€, ì´ë¦„, ë²ˆí˜¸)
- âœ… ìˆ˜ë½ ë²„íŠ¼ (ë…¹ìƒ‰, ê¸€ë¡œìš° íš¨ê³¼)
- âŒ ê±°ì ˆ ë²„íŠ¼ (ë¹¨ê°„ìƒ‰)

---

## âŒ ë¬¸ì œ í•´ê²°

### **ë¬¸ì œ: í† í°ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ**

```bash
âŒ í™œì„± FCM í† í°ì´ ì—†ìŠµë‹ˆë‹¤.
ğŸ’¡ ì•±ì„ ì‹¤í–‰í•˜ê³  ë¡œê·¸ì¸í•˜ì—¬ FCM í† í°ì„ ìƒì„±í•˜ì„¸ìš”.
```

**í•´ê²°:**
1. Flutter ì•± ì‹¤í–‰
2. ë¡œê·¸ì¸
3. ì½˜ì†”ì—ì„œ FCM í† í° í™•ì¸
4. ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

---

### **ë¬¸ì œ: ë©”ì‹œì§€ ë°œì†¡ ì‹¤íŒ¨ (HTTP 401)**

```bash
âŒ ë©”ì‹œì§€ ë°œì†¡ ì‹¤íŒ¨ (HTTP 401)
```

**í•´ê²°:**
- Access Tokenì´ ë§Œë£Œë¨ â†’ ë‹¤ì‹œ ìƒì„±
- Admin SDK JSON íŒŒì¼ í™•ì¸
- Project IDê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸

---

### **ë¬¸ì œ: ì•±ì—ì„œ í’€ìŠ¤í¬ë¦°ì´ í‘œì‹œë˜ì§€ ì•ŠìŒ**

**ì›ì¸ 1: FCM ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜**
- `type: incoming_call` í•„ìˆ˜
- `caller_name`, `caller_number` í•„ìˆ˜

**ì›ì¸ 2: ì•±ì´ ë°±ê·¸ë¼ìš´ë“œ**
- ì•Œë¦¼ íƒ­ í•„ìš”
- í¬ê·¸ë¼ìš´ë“œì—ì„œ í…ŒìŠ¤íŠ¸

**ì›ì¸ 3: BuildContext ë¯¸ì„¤ì •**
- main.dartì—ì„œ `FCMService.setContext(context)` í™•ì¸

---

## ğŸ“š ìì„¸í•œ ë¬¸ì„œ

- **ğŸ“ ìˆ˜ì‹  ì „í™” í…ŒìŠ¤íŠ¸**: `INCOMING_CALL_TEST.md`
- **ğŸ”‘ Authorization ê°€ì´ë“œ**: `GET_FCM_AUTHORIZATION.md`
- **ğŸ”§ Python ìŠ¤í¬ë¦½íŠ¸**: `send_fcm_test_message.py`
- **ğŸš€ Shell ìŠ¤í¬ë¦½íŠ¸**: `send_fcm_curl.sh`

---

## ğŸ’¡ íŒ

### **ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ ë£¨í”„**

```bash
# Terminal 1: Flutter ì•± ì‹¤í–‰
cd /home/user/flutter_app
flutter run -d web-server --web-port 5060

# Terminal 2: FCM ë©”ì‹œì§€ ë°œì†¡ (ë°˜ë³µ ì‹¤í–‰ ê°€ëŠ¥)
python3 docs/fcm_testing/send_fcm_test_message.py
```

### **ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸**

```bash
# ì‹œë‚˜ë¦¬ì˜¤ 1: ì¼ë°˜ ì „í™”
./docs/fcm_testing/send_fcm_curl.sh "" "ê¹€ì² ìˆ˜" "010-1234-5678"

# ì‹œë‚˜ë¦¬ì˜¤ 2: ê¸´ ì´ë¦„
./docs/fcm_testing/send_fcm_curl.sh "" "í™ê¸¸ë™ ë¶€ì¥ë‹˜" "010-9876-5432"

# ì‹œë‚˜ë¦¬ì˜¤ 3: êµ­ì œ ì „í™”
./docs/fcm_testing/send_fcm_curl.sh "" "John Smith" "+1-555-1234"
```

---

**ì‘ì„±ì¼**: 2024-11-03  
**ë²„ì „**: 1.0.0
